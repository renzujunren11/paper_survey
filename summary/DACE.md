# DACE: Distribution-Aware Counterfactual Explanation by Mixed-Integer Linear Optimization
https://www.ijcai.org/Proceedings/2020/0395.pdf

### Abstraction
対事実説明(Counterfactual Explanation: CE)は、分類器から得られる予測結果を変化させるための摂動ベクトルを提供するポストホック説明法の一つである。  
ユーザはこの摂動を、所望の決定結果を得るための「アクション」として直接解釈することができる。  
しかし，既存の手法で抽出されたアクションは，特徴量の相関や外れ値リスクなどの経験的なデータ分布のもつ特性を十分に考慮していないため，ユーザにとっては非現実的なものとなることが多い．  
ユーザに実行可能なアクションを提案するために，経験データの分布上での現実性を評価することでアクションを抽出する新しいフレームワークを提案する．  
提案手法のキーアイデアは、マハラノビス距離と局所的な外れ値因子に基づく新しいコスト関数を定義することである。  
そして、このコスト関数を最小化することで最適なアクションを抽出する混合整数線形最適化手法を提案する。  
現実のデータセットを用いた実験により、既存のCE法と比較して本手法の有効性を確認した。

### Conclusion
本論文では、ラベル付けされた経験分布を考慮して現実的な行動を抽出するための新しいCEの枠組みを提案した。  
マハラノビス距離(MD)と局所的外れ値因子(LOF)に基づく新しいコスト関数を導入し、それを最適化するためのMILO定式化を提案した。  
実験により、既存の手法との比較を行い、本手法の有効性を確認した。今後の課題としては、いくつかの方向性がある。  
まず、より効率的なMILO定式化を考案し、カーネルSVMやディープニューラルネットワークなどの他の分類器にも対応できるようにフレームワークを拡張する予定である。


#### Feature-correlation
それぞれの特徴量は他の特徴量に依存していることが多く、相関関係がゼロではないため、ある特徴について値を変更するコストは、その差の大きさと他の特徴との関係性の両方で評価する必要がある。図 1（左）では，これらの特徴には相関関係があるため，「AverageMInFile」を増やさずに「MSinceOldestTradeOpen」だけを増やすのは不自然であると考えられる。
#### outlier risk
a のコストを最小化することで、その修正インスタンス x¯ + a が経験分布の外れ値になるリスクがある。図1(右)では、x¯ + aの近傍には学習インスタンスがないため、「PercentInstallTrades」を減らさずに「ExternalRiskEstimate」を増加させることは非現実的であると考えられる。

### our contribution
- マハラビノス距離(MD)と局所外れ値因子(LOF)によってアクションの実現性を評価
- LOFはK近傍法によって計算する
- 混合整数線形最適化問題として解く

### Related work
- モデルの説明をするポストホック法が注目
- CEの多くは、勾配法やヒューリスティックを利用しtており、微分可能かつ連続変数のモデルにのみ適用できる
- この問題に対処するため線形なコストに対する整数線形最適化(ILO)が提案された
- 我々の手法は非線形なコスト(MD, LOF)に拡張されている

### Distribution-aware score for CE
- 近年、ロバスト性の低さが言われている
- 与えられたデータを訓練データを含まない空の決定領域に転送する無意味なアクションを除外するために、アクションの連結性という概念を導入
- この論文は[Laugel et al., 2019a]が提唱したクライテリアの初めての最適化だ。

### 問題設定
- タスク予測を二値分類問題として解く
- マルチクラスの場合は、1対他分類として扱う
- カテゴリ変数は前処理でone-hotエンコーディングを行う

### MILO Formulation
#### Basic idea
- $C_{DACE}$は非線形であり、$N_k(\bar{x} + a)$による離散構造を持つが、整数最適化のモデル化技術を用いて、Problem1を正確にMILO問題として定式化することができる。
- しかし、非線形性と離散性を線形化するために、このナイーブな定式化では、$O(|A|^2 + N^2 )$の補助変数と制約が必要であり、ここでは $|A| := \sum^D_{d=1} |A_d|$となります。
- 予備実験により、この定式化は標準的なデータセットでは計算不能であることが明らかになりました。
- $O(|A|^2 + N^2 )$の補助変数や制約の導入を避けるために、$C_{DACE}$の代わりにサロゲート目的関数を導入して最適化します。
- our main idea is
    - LOFの近傍数をk=1にする
    - マハラビノス距離をL1ノームにする
        - マハラビノス距離$d^2_Mが||U(x'-x)||_2$で表せることから
    - Problem1をMILO定式化として扱う
        - $ \minimize _{a∈A} \hat{d}_M(\bar{x}, \bar{x}+a|M) + \lambda・q_1(\bar{x}+a|X)$
        - 制約条件：$H(\bar{x}+a) = +1$

#### Base Learner Constraints

### Experiments
実データセットを用いた実験を行い、既存のCEの手法と比較してDACEの有効性を検証した。  
コードはすべてPython 3.6、scikit-learn、IBM ILOG CPLEX v12.8で実装した。  
すべての実験は、Intel Xeon E5-1620 v4 3.50GHzのCPUと62.8GiBのメモリを搭載した64ビットUbuntu 18.04.1 LTS上で行われ、解くために600秒の制限時間を課した。  
#### Setting
- FICO dataset (D = 23) [FICO et al., 2018]
- german dataset (D = 61) [Dua and Graff, 2017]
    - D:特徴量の数
    - カテゴリ変数はone-hot変換済み
- 各個人がローンをデフォルトするか予測
- ロジスティック回帰
- ランダムフォレスト(T=100)
- 各テストデータセットの中で、各モデルから「デフォルトのリスクが高い」と予測されたインスタンス$\hat{x}$に対するアクションを抽出した。
#### baseline
- MAD
- TLPS
- PCC
#### Evaluation Score
- $d_M(\bar{x}+a, \bar{x}|\sum^{-1})$
    - 相関を考慮して$\bar{x}$に対してアクションaを実行する労力
- 10-LOF : $q_{10}(\bar{x}+a|X_{+})$
    - $X_+$:訓練データ中の「デフォルトリスクの低い」インスタンス
    - アクションaによって変更されたxが、変更されたラベルをもつインスタンスに比べて外れ値になるリスク
- 計算時間
####  Comparison with Existing Methods
- FICO : λ=1.0を設定(感度分析の結果を元に決定)
- german : λ=0.01を設定(感度分析の結果を元に決定)
- 既存手法に比べて低い、MDと10-LOF
- 計算時間は10~100倍
- 5min現実的な時間で既存手法よりも現実的なアクションを抽出できた
